<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.babmukja.repository.mapper.MeetupMapper">
	<resultMap id="meetupMap" type="meetup">
		<result column="meet_no" property="meetNo" />
		<result column="total_mem" property="totalMem" />
		<result column="fee" property="fee" />
		<result column="intro" property="intro" />
		<result column="title" property="title" />
		<result column="day" property="day" />
		<result column="category" property="category" />
		<result column="file_dir" property="fileDir" />
		<result column="view_cnt" property="viewCnt" />
		<result column="location" property="location" />
	</resultMap>	
    
    <select id="selectIntro" resultType="String">
    	select intro from tb_meetup WHERE meet_no= 19
    </select>
    
    <insert id="insertMeetupBoard" parameterType="meetup">
    	<selectKey keyProperty="meetNo" resultType="int" order="AFTER">
			SELECT LAST_INSERT_ID()
		</selectKey>
    	insert into tb_meetup(meet_no,fee,title,day,category,file_dir,location)
    	 			   values(#{meetNo},#{fee},#{title},#{day},#{category},#{fileDir},#{location})
    </insert>
    
    <insert id="insertMeetupLocation" parameterType="meetupLocation">
    	insert into tb_meetup_location(meet_no,city,town)
    	 			   values(#{meetNo},#{city},#{town})
    </insert>
    
    <update id= "updateIntro" parameterType="String">
    UPDATE tb_meetup SET intro = #{intro} WHERE meet_no= 19
    
    </update>
    
     <update id= "deleteIntro" parameterType="String">
    UPDATE tb_meetup SET intro = null WHERE meet_no= 1
    
    </update>
    
    
    
	<select id="selectMeetup" resultMap="meetupMap" parameterType="pageAfterSearch">
		select * 
		from tb_meetup
	where title like concat('%',#{search},'%') and category like concat('%',#{category},'%') 
	  <choose>
	  <when test="fee != 0">
	and  REPLACE(fee, ',', '') <![CDATA[ <=]]>  #{fee}

	</when>
	<when test="fee == 0">
	and  REPLACE(fee, ',', '') <![CDATA[ >=]]>  #{fee}

	</when>
	</choose>
	and ( (location like concat('%',#{city1},'%') and location like concat('%',#{town1},'%')) or 
		   (location like concat('%',#{city2},'%') and location like concat('%',#{town2},'%')) or
		   (location like concat('%',#{city3},'%') and location like concat('%',#{town3},'%'))
	)
		 limit #{begin}, #{end}	
	</select>
	
	<select id="selectAllMeetupCount" resultType="int">
		select count(*)
		  from tb_meetup
	</select>
    
   
</mapper>